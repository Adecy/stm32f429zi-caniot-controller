# https://docs.zephyrproject.org/latest/reference/kconfig/index-all.html

# -----------------------------------------------------------------------------

# CONFIG_KERNEL_BIN_NAME="zephyr"

# -----------------------------------------------------------------------------

# Print a banner on the UART on startup.
CONFIG_BOOT_BANNER=y

# -----------------------------------------------------------------------------

# GENERAL

# fs function needs a lot of stack/ram in general
CONFIG_MAIN_STACK_SIZE=2048

# https://docs.zephyrproject.org/latest/reference/kernel/threads/workqueue.html#configuration-options
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048
CONFIG_SYSTEM_WORKQUEUE_PRIORITY=-1
CONFIG_SYSTEM_WORKQUEUE_NO_YIELD=n

CONFIG_INIT_STACKS=y

CONFIG_TIMEOUT_64BIT=y

CONFIG_POSIX_API=y

CONFIG_NEWLIB_LIBC=y
CONFIG_NEWLIB_LIBC_NANO=n
CONFIG_NEWLIB_LIBC_MIN_REQUIRED_HEAP_SIZE=4096
CONFIG_NEWLIB_LIBC_FLOAT_PRINTF=y
CONFIG_NEWLIB_LIBC_FLOAT_SCANF=y

CONFIG_HEAP_MEM_POOL_SIZE=1024
CONFIG_SYS_HEAP_RUNTIME_STATS=y

CONFIG_POLL=y

# CONFIG_CBPRINTF_PACKAGE_LOG_LEVEL_ERR=y

# -----------------------------------------------------------------------------

# LOGGING
# https://docs.zephyrproject.org/latest/reference/logging/index.html
CONFIG_LOG=y
CONFIG_PRINTK=y

# CONFIG_CONSOLE=y
# CONFIG_UART_CONSOLE=y
# CONFIG_STDOUT_CONSOLE=y

CONFIG_CBPRINTF_FP_SUPPORT=y

# CONFIG_LOG_STRDUP_MAX_STRING=64
# CONFIG_LOG_STRDUP_BUF_COUNT=42
# CONFIG_LOG_BUFFER_SIZE=2048
# CONFIG_LOG_MODE_DEFERRED=n

# enable to immediate while debugging or when having immediate response is needed
# disable to log time sensitive functions (need a bit more RAM for a thread and pools)
CONFIG_LOG_MODE_IMMEDIATE=n


# -----------------------------------------------------------------------------

# DEBUG
CONFIG_ASSERT=n
# CONFIG_ASSERT_ON_ERRORS=y
# CONFIG_NO_RUNTIME_CHECKS=n
CONFIG_RUNTIME_ERROR_CHECKS=y


CONFIG_THREAD_MONITOR=n

# https://docs.zephyrproject.org/latest/guides/flash_debug/thread-analyzer.html
# -> disable CONFIG_LOG_MODE_IMMEDIATE when using THREAD analyser
CONFIG_THREAD_NAME=y
CONFIG_THREAD_ANALYZER=n            
# CONFIG_THREAD_ANALYZER_USE_PRINTK=n
# CONFIG_THREAD_ANALYZER_USE_LOG=y
# CONFIG_THREAD_ANALYZER_AUTO=y
# CONFIG_THREAD_ANALYZER_AUTO_INTERVAL=10
# THREAD_ANALYZER_AUTO_STACK_SIZE
CONFIG_THREAD_RUNTIME_STATS=y

# -----------------------------------------------------------------------------

CONFIG_NETWORKING=y
CONFIG_NET_UDP=y
CONFIG_NET_TCP=y

CONFIG_NET_IPV4=y
CONFIG_NET_IPV6=n
CONFIG_NET_TCP=y
CONFIG_NET_ARP=y
CONFIG_NET_UDP=y

CONFIG_NET_STATISTICS=y
CONFIG_NET_STATISTICS_USER_API=y
CONFIG_NET_STATISTICS_IPV4=y
CONFIG_NET_STATISTICS_ICMP=y
CONFIG_NET_STATISTICS_TCP=y
CONFIG_NET_STATISTICS_UDP=y

CONFIG_NET_CONNECTION_MANAGER=n

CONFIG_NET_HOSTNAME_ENABLE=y
CONFIG_NET_HOSTNAME="caniot-ctrl"
CONFIG_POSIX_UNAME_NODENAME_LEN=12

# TO DEBUG
# CONFIG_NET_DRIVERS=y
# CONFIG_NET_LOOPBACK=y
# CONFIG_NET_LOOPBACK_LOG_LEVEL_DBG=y
CONFIG_NET_IF_MAX_IPV4_COUNT=2

CONFIG_NET_MGMT=y
CONFIG_NET_MGMT_EVENT=y
CONFIG_NET_MGMT_EVENT_LOG_LEVEL_INF=y

CONFIG_NET_SOCKETS=y

CONFIG_NET_SOCKETS_SOCKOPT_TLS=y
CONFIG_NET_SOCKETS_TLS_MAX_CONTEXTS=4
CONFIG_NET_SOCKETS_TLS_MAX_CLIENT_SESSION_COUNT=4

CONFIG_NET_DEFAULT_IF_ETHERNET=y

CONFIG_NET_SOCKETS_TLS_PEER_VERIFY_CALLBACK=y

# 2 for HTTPS server + 1 CA if peer verification is enabled
# 3 for AWS IoT
CONFIG_TLS_MAX_CREDENTIALS_NUMBER=6

# https://github.com/zephyrproject-rtos/zephyr/issues/39705
# incompatible with CONFIG_POSIX_API option
# CONFIG_NET_SOCKETS_POSIX_NAMES=y

CONFIG_NET_BUF_DATA_SIZE=128

CONFIG_NET_PKT_RX_COUNT=16
CONFIG_NET_BUF_RX_COUNT=36

CONFIG_NET_PKT_TX_COUNT=48
CONFIG_NET_BUF_TX_COUNT=192

# CONFIG_NET_TCP_MAX_SEND_WINDOW_SIZE=16384
# CONFIG_NET_TCP_MAX_RECV_WINDOW_SIZE=16384

CONFIG_DNS_RESOLVER=y
CONFIG_DNS_RESOLVER_ADDITIONAL_BUF_CTR=1
CONFIG_DNS_RESOLVER_ADDITIONAL_QUERIES=1
CONFIG_DNS_RESOLVER_AI_MAX_ENTRIES=1

CONFIG_DNS_RESOLVER_MAX_SERVERS=1

CONFIG_DNS_RESOLVER_LOG_LEVEL_DBG=n

# CONFIG_DNS_RESOLVER_AUTO_INIT=y
# CONFIG_MDNS_RESOLVER=y
# CONFIG_LLMNR_RESOLVER=n
# CONFIG_DNS_RESOLVER_MAX_SERVERS=2
# CONFIG_DNS_SERVER_IP_ADDRESSES=y
# CONFIG_DNS_NUM_CONCUR_QUERIES=5

# https://docs.zephyrproject.org/latest/reference/kconfig/CONFIG_DNS_SERVER1.html#std-kconfig-CONFIG_DNS_SERVER1
# Set CONFIG_DNS_RESOLVER_MAX_SERVERS to 2 if enabling next configuration option
# CONFIG_DNS_SERVER_IP_ADDRESSES=y
# CONFIG_DNS_SERVER1="192.168.10.6"

# Config SNTP
CONFIG_SNTP=y
CONFIG_SNTP_LOG_LEVEL_DBG=n

CONFIG_NET_LOG=y
# IMPORTANT - CONFIG_NET_SOCKETS_LOG_LEVEL_DBG should also be enabled when debugging MBEDTLS stack
CONFIG_NET_SOCKETS_LOG_LEVEL_DBG=n
CONFIG_NET_IF_LOG_LEVEL_DBG=n
CONFIG_NET_TCP_LOG_LEVEL_DBG=n
CONFIG_NET_UDP_LOG_LEVEL_DBG=n
CONFIG_NET_CONFIG_LOG_LEVEL_DBG=n
CONFIG_NET_L2_ETHERNET_LOG_LEVEL_INF=n
CONFIG_NET_CORE_LOG_LEVEL_DBG=n
CONFIG_NET_CONN_LOG_LEVEL_DBG=n

CONFIG_NET_CONFIG_SETTINGS=n
CONFIG_NET_CONFIG_AUTO_INIT=n
CONFIG_NET_CONFIG_CLOCK_SNTP_INIT=n
CONFIG_NET_CONFIG_NEED_IPV6=n
CONFIG_NET_CONFIG_NEED_IPV4=n

CONFIG_NET_MAX_CONN=12
CONFIG_NET_MAX_CONTEXTS=14
CONFIG_POSIX_MAX_FDS=16
CONFIG_NET_SOCKETS_POLL_MAX=7

# https://docs.zephyrproject.org/latest/reference/kconfig/CONFIG_NET_TCP_TIME_WAIT_DELAY.html#std-kconfig-CONFIG_NET_TCP_TIME_WAIT_DELAY
# free TCP context immediately when closed
CONFIG_NET_TCP_TIME_WAIT_DELAY=0

# https://docs.zephyrproject.org/latest/reference/kconfig/CONFIG_NET_TCP_BACKLOG_SIZE.html#std-kconfig-CONFIG_NET_TCP_BACKLOG_SIZE
# CONFIG_NET_TCP_BACKLOG_SIZE=5

# -----------------------------------------------------------------------------

CONFIG_MBEDTLS_BUILTIN=y

# we disable heap as we will allocate it manually in CCM using mbedtls_memory_buffer_alloc_init
CONFIG_MBEDTLS_ENABLE_HEAP=n
# CONFIG_MBEDTLS_HEAP_SIZE=65536

CONFIG_MBEDTLS_SSL_MAX_CONTENT_LEN=10240
CONFIG_NET_SOCKETS_TLS_SET_MAX_FRAGMENT_LENGTH=y

# TODO: Evaluate use of following options
# CONFIG_CUSTOM_MBEDTLS_CFG_FILE=y
# CONFIG_MBEDTLS_CFG_FILE="config-mini-tls1_2.h"

CONFIG_MBEDTLS_CFG_FILE="config-tls-generic.h"
CONFIG_MBEDTLS_USER_CONFIG_ENABLE=y
CONFIG_MBEDTLS_USER_CONFIG_FILE="mbedtls-cfg.h"

CONFIG_MBEDTLS_CIPHER=y

# CONFIG_MBEDTLS_ALL=y
# CONFIG_MBEDTLS_MD4=y
# CONFIG_MBEDTLS_MD5=y
# CONFIG_MBEDTLS_SHA1=y
CONFIG_MBEDTLS_SHA256=y
CONFIG_MBEDTLS_SHA384=y
CONFIG_MBEDTLS_SHA512=y
# CONFIG_MBEDTLS_POLY1305=y
# CONFIG_MBEDTLS_CMAC=y

# CONFIG_MBEDTLS_CIPHER_ALL_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_AES_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_CAMELLIA_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_DES_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_ARC4_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_CHACHA20_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_BLOWFISH_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_CCM_ENABLED=y
CONFIG_MBEDTLS_CIPHER_GCM_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_MODE_XTS_ENABLED=y
CONFIG_MBEDTLS_CIPHER_MODE_CBC_ENABLED=y
# CONFIG_MBEDTLS_CIPHER_MODE_CTR_ENABLED=y
# CONFIG_MBEDTLS_CHACHAPOLY_AEAD_ENABLED=y

CONFIG_MBEDTLS_KEY_EXCHANGE_ALL_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_PSK_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_DHE_PSK_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_PSK_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_RSA_PSK_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_RSA_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_DHE_RSA_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_RSA_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_ECDHE_ECDSA_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_ECDH_ECDSA_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_ECDH_RSA_ENABLED=y
# CONFIG_MBEDTLS_KEY_EXCHANGE_ECJPAKE_ENABLED=y

CONFIG_MBEDTLS_ECP_C=y
CONFIG_MBEDTLS_ECDH_C=y
CONFIG_MBEDTLS_ECDSA_C=y
CONFIG_MBEDTLS_ECJPAKE_C=y

CONFIG_MBEDTLS_ECP_ALL_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_SECP192R1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_SECP192R1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_SECP224R1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_SECP256R1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_SECP384R1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_SECP521R1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_SECP192K1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_SECP224K1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_SECP256K1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_BP256R1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_BP384R1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_BP512R1_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_CURVE25519_ENABLED=y
# CONFIG_MBEDTLS_ECP_DP_CURVE448_ENABLED=y
# CONFIG_MBEDTLS_ECP_NIST_OPTIM=y

CONFIG_MBEDTLS_PEM_CERTIFICATE_FORMAT=y

# Enable hardware acceleration
CONFIG_CRYPTO=y

# Enable hardware entropy generator
CONFIG_ENTROPY_GENERATOR=y

# don't use test random generator in production
CONFIG_TEST_RANDOM_GENERATOR=n

CONFIG_MBEDTLS_TLS_VERSION_1_1=n
CONFIG_MBEDTLS_TLS_VERSION_1_0=n
CONFIG_MBEDTLS_TLS_VERSION_1_2=y
# CONFIG_MBEDTLS_TLS_VERSION_1_3=y

# Debug
CONFIG_MBEDTLS_DEBUG=n
CONFIG_MBEDTLS_LOG_LEVEL_DBG=n
CONFIG_MBEDTLS_MEMORY_DEBUG=y

# -----------------------------------------------------------------------------

CONFIG_MPU_ALLOW_FLASH_WRITE=y

CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y

CONFIG_NVS=y
CONFIG_NVS_LOG_LEVEL_DBG=y

CONFIG_FILE_SYSTEM=y
CONFIG_FILE_SYSTEM_MAX_TYPES=1

CONFIG_DISK_ACCESS=y
CONFIG_DISK_LOG_LEVEL_DBG=y

CONFIG_FAT_FILESYSTEM_ELM=y
CONFIG_FS_FATFS_EXFAT=y
CONFIG_FS_LOG_LEVEL_INF=y

# -----------------------------------------------------------------------------

CONFIG_ZVFS_EVENTFD=y
CONFIG_ZVFS_EVENTFD_MAX=2

# -----------------------------------------------------------------------------

CONFIG_HTTP_CLIENT=y
CONFIG_HTTP_PARSER=y
CONFIG_JSON_LIBRARY=y

# -----------------------------------------------------------------------------

CONFIG_MQTT_LIB=y
CONFIG_MQTT_LIB_TLS=y
CONFIG_MQTT_KEEPALIVE=60
# CONFIG_MQTT_LOG_LEVEL_DBG=y

# -----------------------------------------------------------------------------

CONFIG_SYS_MEM_BLOCKS=y

# -----------------------------------------------------------------------------

# CONFIG_PICOLIBC_MODULE=y

# -----------------------------------------------------------------------------

CONFIG_LUA=n
# CONFIG_APP_LUA_FS_DEFAULT_SCRIPTS=y
# CONFIG_APP_LUA_AUTORUN_SCRIPTS=y

# -----------------------------------------------------------------------------

CONFIG_APP_DISCOVERY_SERVER=y
# CONFIG_APP_DISCOVERY_SERVER_LOG_LEVEL=4

# -----------------------------------------------------------------------------

CONFIG_APP_CLOUD=y

# -----------------------------------------------------------------------------

CONFIG_APP_HTTP_SERVER=y
CONFIG_APP_HTTP_REQUEST_HEADERS_BUFFER_SIZE=352
CONFIG_APP_HTTP_SERVER_NONSECURE=y
CONFIG_APP_HTTP_SERVER_SECURE=y
CONFIG_APP_HTTP_SERVER_VERIFY_CLIENT=y

# -----------------------------------------------------------------------------

CONFIG_EMBEDC_URL_PARSER=y